name: Tests et DÃ©ploiement du Sommelier

on:
  push:
    branches: [ main, master ]

# Permissions obligatoires pour que le robot ait le droit de publier sur votre site
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  # === MISSION 1 : LE TESTEUR ===
  tester-application:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ“¥ RÃ©cupÃ©rer le code
      uses: actions/checkout@v4
    - name: âš™ï¸ Installer NodeJS
      uses: actions/setup-node@v4
      with:
        node-version: 18
    - name: ğŸ“¦ Installer les dÃ©pendances NPM
      run: npm install
    - name: ğŸŒ Installer Serve
      run: npm install -g serve
    - name: ğŸ¤– Installer les navigateurs Playwright
      run: npx playwright install --with-deps
    - name: âœ… Lancer les tests Playwright
      run: npx playwright test

  # === MISSION 2 : LE DÃ‰PLOIEMENT ===
  deployer-site:
    # LA LIGNE MAGIQUE : Ce job attend que "tester-application" soit validÃ© !
    needs: tester-application 
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: ğŸ“¥ RÃ©cupÃ©rer le code validÃ©
        uses: actions/checkout@v4
      - name: âš™ï¸ Configurer GitHub Pages
        uses: actions/configure-pages@v5
      - name: ğŸ“¦ PrÃ©parer les fichiers (Toute la racine)
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
      - name: ğŸš€ Publier le site en ligne
        id: deployment
        uses: actions/deploy-pages@v4